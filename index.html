<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EcoCart Demo - User-Friendly (USD)</title>
<style>
body { font-family: Arial; padding:20px; background:#f3f3f3; transition:0.3s; }
body.dark { background:#121212; color:#fff; }
h1 { text-align:center; color:#2e7d32; }
body.dark h1 { color:#81c784; }

.controls { text-align:center; margin-bottom:20px; }
button { padding:5px 10px; margin:5px; border-radius:6px; cursor:pointer; }
.scan-btn { background:#4caf50; color:#fff; font-weight:bold; border:none; }
.scan-btn:hover { background:#388e3c; }

.container { display:flex; gap:20px; flex-wrap:wrap; justify-content:center; }
.products, .cart { background:white; padding:20px; border-radius:12px; width:300px; box-shadow:0 4px 10px rgba(0,0,0,0.2); }
body.dark .products, body.dark .cart { background:#1c1c1c; color:#fff; }

.product-card, .cart-item { display:flex; gap:10px; margin-bottom:10px; align-items:center; }
.product-card img, .cart-item img { width:60px; height:60px; object-fit:cover; border-radius:6px; }
.product-details { flex:1; }
.price { font-weight:bold; color:#2e7d32; }
body.dark .price { color:#81c784; }

.cart-total { font-weight:bold; text-align:right; margin-top:10px; color:#2e7d32; }
body.dark .cart-total { color:#81c784; }
.pay-button { width:100%; padding:10px; margin-top:10px; background:#4caf50; color:#fff; border:none; border-radius:8px; font-weight:bold; cursor:pointer; }
.pay-button:hover { background:#388e3c; }

#qrContainer { text-align:center; margin-top:20px; display:none; }
#qrContainer img { width:200px; height:200px; }
</style>
</head>
<body>

<h1>EcoCart Demo</h1>

<div class="controls">
<button class="scan-btn" onclick="scanAllProducts()">Scan Products</button>
<button onclick="toggleDarkMode()">Toggle Dark/Light Mode</button>
</div>

<div class="container">
<div class="products" id="productsContainer"></div>
<div class="cart">
<h2>Your Cart</h2>
<div id="cartItems"></div>
<div class="cart-total" id="cartTotal">Total: $0.00</div>
<button class="pay-button" onclick="showQRCode()">Pay Online</button>

<div id="qrContainer">
<h3>Scan this QR code to pay</h3>
<img id="qrImage" alt="QR Code">
<br>
<button onclick="hideQRCode()">Close QR</button>
</div>

<div id="historyContainer"><strong>Purchase History:</strong></div>
</div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>
<script>
let productsData = [
{name:"Apple", price:2.0, img:"https://upload.wikimedia.org/wikipedia/commons/1/15/Red_Apple.jpg"},
{name:"Banana", price:1.5, img:"https://upload.wikimedia.org/wikipedia/commons/8/8a/Banana-Single.jpg"},
{name:"Milk", price:3.0, img:"https://media.istockphoto.com/id/1206080627/photo/glass-of-milk.jpg"},
{name:"Cheese", price:4.5, img:"https://pearlvalleycheese.com/cdn/shop/files/charcuterie-board-with-swiss-cheese.jpg?v=1678982236&width=1000"}
];

let cart = [];

// Render products
function renderProducts(){
    const container = document.getElementById('productsContainer');
    container.innerHTML = '';
    productsData.forEach((p,index)=>{
        let div = document.createElement('div');
        div.className = 'product-card';
        div.innerHTML = `
        <img src="${p.img}" alt="${p.name}">
        <div class="product-details">
        <div>${p.name}</div>
        <div class="price">$${p.price.toFixed(2)}</div>
        <div>
            <button onclick="addToCart(${index})">Add</button>
        </div>
        </div>`;
        container.appendChild(div);
    });
}
function addToCart(index){
    let prod = productsData[index];
    let item = cart.find(c=>c.name===prod.name);
    if(item){ item.quantity++; item.total = item.quantity*prod.price; }
    else{ cart.push({name:prod.name, quantity:1, total:prod.price, img:prod.img}); }
    updateCartDisplay();
}
function updateCartDisplay(){
    const container = document.getElementById('cartItems');
    container.innerHTML='';
    let total=0;
    cart.forEach((item,i)=>{
        total+=item.total;
        let div = document.createElement('div');
        div.className='cart-item';
        div.innerHTML=`<img src="${item.img}"><div>${item.name} x${item.quantity}</div><div>$${item.total.toFixed(2)}</div>`;
        container.appendChild(div);
    });
    document.getElementById('cartTotal').innerText='Total: $'+total.toFixed(2);
}
function scanAllProducts(){ updateCartDisplay(); }
function toggleDarkMode(){ document.body.classList.toggle('dark'); }

function showQRCode(){
    if(cart.length===0){ alert("Cart is empty!"); return; }
    // Lưu giỏ hàng tạm để Payment page lấy
    localStorage.setItem('currentCart', JSON.stringify(cart));

    let total = cart.reduce((sum,item)=>sum+item.total,0).toFixed(2);
    let paymentLink = `payment.html?amount=${total}`;
    document.getElementById('qrContainer').style.display='block';
    new QRious({
        element: document.getElementById('qrImage'),
        value: paymentLink,
        size: 200
    });
}
function hideQRCode(){ document.getElementById('qrContainer').style.display='none'; }

// Load history
let savedHistory = localStorage.getItem('purchaseHistory');
if(savedHistory) document.getElementById('historyContainer').innerHTML = savedHistory;

renderProducts();
</script>

</body>
</html>
