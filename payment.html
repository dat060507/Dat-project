<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EcoCart Payment</title>
<style>
body{font-family:Arial;padding:20px;transition:0.3s;background:#f3f3f3;color:#000;}
body.dark{background:#121212;color:#fff;}
.container{background:white;padding:20px;border-radius:16px;width:350px;margin:auto;box-shadow:0 4px 10px rgba(0,0,0,0.2);}
body.dark .container{background:#1c1c1c;}
h2{color:#2e7d32;}
body.dark h2{color:#81c784;}
.cart-item{display:flex;justify-content:space-between;margin-bottom:10px;align-items:center;}
.cart-item img{width:50px;height:50px;object-fit:cover;border-radius:6px;}
.amount{font-size:24px;font-weight:bold;text-align:right;margin-top:10px;color:#2e7d32;}
body.dark .amount{color:#81c784;}
.button{width:100%;padding:12px;background:#4caf50;border:none;color:white;border-radius:8px;font-size:18px;margin-top:20px;cursor:pointer;}
.button:hover{background:#388e3c;}
.cancel{margin-top:10px;border:none;background:none;color:#333;cursor:pointer;}
body.dark .cancel{color:#ccc;}
canvas{margin-top:10px;}
</style>
</head>
<body>
<div class="container">
<h2>EcoCart Payment</h2>
<div id="cartContainer"></div>
<div class="amount" id="amount">$0.00</div>

<h3>Scan QR to Pay</h3>
<canvas id="qrCanvas"></canvas>

<button class="button" onclick="payNow()">Pay Now</button>
<button class="cancel" onclick="window.history.back()">Cancel</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>
<script>
const params = new URLSearchParams(window.location.search);
let amount = parseFloat(params.get("amount")||0).toFixed(2);
document.getElementById("amount").innerText="$"+amount;

let cart = JSON.parse(localStorage.getItem('currentCart')||"[]");
const cartContainer=document.getElementById('cartContainer');
cart.forEach(item=>{
    let div=document.createElement('div');
    div.className='cart-item';
    div.innerHTML=`<img src="${item.img}"><div>${item.name} x${item.quantity}</div><div>$${item.total.toFixed(2)}</div>`;
    cartContainer.appendChild(div);
});

// QR code lớn, dễ quét
let paymentLink = encodeURIComponent(`https://yourdomain.com/simulate_payment.html?amount=${amount}`);
let qr = new QRious({
    element: document.getElementById('qrCanvas'),
    value: paymentLink,
    size: 300,
    level: 'H'
});

function payNow(){
    let savedHistory = JSON.parse(localStorage.getItem('purchaseHistory')||"[]");
    const now = new Date();
    const date = now.toLocaleDateString();
    const time = now.toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'});
    let session = {datetime:`${date} ${time}`, items:cart, total:amount};
    savedHistory.unshift(session);
    localStorage.setItem('purchaseHistory', JSON.stringify(savedHistory));
    localStorage.removeItem('currentCart');
    window.location.href="success.html";
}

if(localStorage.getItem('darkMode')==='true') document.body.classList.add('dark');
</script>
</body>
</html>

